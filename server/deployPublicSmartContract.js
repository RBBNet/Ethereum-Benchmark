const {web3} = require("./pantheon_utils/web3")
const {deploySmartContract} = require('./pantheon_utils/web3Operations')
//binary to deploy the smart contract
const simpleStorageByteCode = "0x608060405234801561001057600080fd5b5060c78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80636057361d146037578063b05784b8146062575b600080fd5b606060048036036020811015604b57600080fd5b8101908080359060200190929190505050607e565b005b60686088565b6040518082815260200191505060405180910390f35b8060008190555050565b6000805490509056fea26469706673582212208595760c8d4272f1711ffb94441dddc78e22630630efc2bc60b984de1caeb06c64736f6c63430006030033"
const david19Bytecode = "0x608060405234801561001057600080fd5b50610cc2806100206000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c8063b75c7dc614610046578063b88fbd2d1461008c578063d2ae498d146100f2575b600080fd5b6100726004803603602081101561005c57600080fd5b81019080803590602001909291905050506101b2565b604051808215151515815260200191505060405180910390f35b6100d8600480360360408110156100a257600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610545565b604051808215151515815260200191505060405180910390f35b610198600480360361012081101561010957600080fd5b8101908080359060200190929190803590602001909291908035906020019092919080359060200190929190803560ff169060200190929190803560ff169060200190929190803579ffffffffffffffffffffffffffffffffffffffffffffffffffff19169060200190929190803560ff169060200190929190803560ff169060200190929190505050610770565b604051808215151515815260200191505060405180910390f35b60008060008084815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002090506000801b81600001541415610283576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f63726564656e7469616c206861736820646f65736e277420657869737400000081525060200191505060405180910390fd5b80600401600a9054906101000a900460ff16610307576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f43726564656e7469616c20697320616c7265616479207265766f6b656400000081525060200191505060405180910390fd5b600081600401600a6101000a81548160ff0219169083151502179055508060008085815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082015481600001556001820154816001015560028201548160020155600382015481600301556004820160009054906101000a900460ff168160040160006101000a81548160ff021916908360038111156103cd57fe5b02179055506004820160019054906101000a900460ff168160040160016101000a81548160ff021916908360ff1602179055506004820160029054906101000a900460d01b8160040160026101000a81548165ffffffffffff021916908360d01c02179055506004820160089054906101000a900460ff168160040160086101000a81548160ff0219169083600481111561046457fe5b02179055506004820160099054906101000a900460ff168160040160096101000a81548160ff0219169083600781111561049a57fe5b021790555060048201600a9054906101000a900460ff1681600401600a6101000a81548160ff021916908315150217905550905050827f80d4746828447d65eceb938c7f9d85fbeb232fe7819d5209ed452b3940f8904b3342604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a26001915050919050565b600061054f610bf4565b60008085815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405180610140016040529081600082015481526020016001820154815260200160028201548152602001600382015481526020016004820160009054906101000a900460ff1660038111156105f057fe5b60038111156105fb57fe5b81526020016004820160019054906101000a900460ff1660ff1660ff1681526020016004820160029054906101000a900460d01b79ffffffffffffffffffffffffffffffffffffffffffffffffffff191679ffffffffffffffffffffffffffffffffffffffffffffffffffff191681526020016004820160089054906101000a900460ff16600481111561068b57fe5b600481111561069657fe5b81526020016004820160099054906101000a900460ff1660078111156106b857fe5b60078111156106c357fe5b815260200160048201600a9054906101000a900460ff16151515158152505090506000801b81600001511415610761576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f43726564656e7469616c206861736820646f65736e277420657869737400000081525060200191505060405180910390fd5b80610120015191505092915050565b6000806000808c815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002090506000801b816000015414610840576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601c8152602001807f43726564656e7469616c20494420616c7265616479206578697374730000000081525060200191505060405180910390fd5b8981600001819055508881600101819055506103e842028160020181905550878160030181905550868160040160006101000a81548160ff0219169083600381111561088857fe5b0217905550858160040160016101000a81548160ff021916908360ff160217905550848160040160026101000a81548165ffffffffffff021916908360d01c0217905550838160040160086101000a81548160ff021916908360048111156108ec57fe5b0217905550828160040160096101000a81548160ff0219169083600781111561091157fe5b0217905550600181600401600a6101000a81548160ff021916908315150217905550806000808d815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082015481600001556001820154816001015560028201548160020155600382015481600301556004820160009054906101000a900460ff168160040160006101000a81548160ff021916908360038111156109dc57fe5b02179055506004820160019054906101000a900460ff168160040160016101000a81548160ff021916908360ff1602179055506004820160029054906101000a900460d01b8160040160026101000a81548165ffffffffffff021916908360d01c02179055506004820160089054906101000a900460ff168160040160086101000a81548160ff02191690836004811115610a7357fe5b02179055506004820160099054906101000a900460ff168160040160096101000a81548160ff02191690836007811115610aa957fe5b021790555060048201600a9054906101000a900460ff1681600401600a6101000a81548160ff0219169083151502179055509050508a7fb63f373d7241d415ff725faa8c7def04dee5b4bd089fb60925610470fbedbaa4338c8c85600201548c8b8b8b604051808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001888152602001878152602001868152602001856003811115610b6057fe5b60ff1681526020018479ffffffffffffffffffffffffffffffffffffffffffffffffffff191679ffffffffffffffffffffffffffffffffffffffffffffffffffff19168152602001836004811115610bb457fe5b60ff168152602001826007811115610bc857fe5b60ff1681526020019850505050505050505060405180910390a260019150509998505050505050505050565b6040518061014001604052806000801916815260200160008152602001600081526020016000815260200160006003811115610c2c57fe5b8152602001600060ff168152602001600079ffffffffffffffffffffffffffffffffffffffffffffffffffff1916815260200160006004811115610c6c57fe5b815260200160006007811115610c7e57fe5b8152602001600015158152509056fea265627a7a7231582086fbc93e3262831256c1226d4ed3685aed5b0e6ccfa953f17182c0fea3dd70f064736f6c63430005110032"
// set to 1 for faster validation in this course.
web3.transactionConfirmationBlocks = 1;

const SMART_CONTRACT_OPTION  = process.env.SMART_CONTRACT_OPTION

const addressFrom = '0xfe3b557e8fb62b89f4916b721be55ceb828dbd73'
const privKey = Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63', 'hex')

const nodeAddress = '0xd00e6624a73f88b39f82ab34e8bf2b4d226fd768';
const expiration = 1636394529;
let valueAdd= web3.eth.abi.encodeParameters(
  ["address","uint256"],
  [nodeAddress,expiration]);

console.log("valueAdd" + valueAdd.substr(2))

let contractData

const chooseSmartByteCode = () => {
  if (SMART_CONTRACT_OPTION==0){
    contractData = simpleStorageByteCode +  valueAdd.substr(2);
  }else if (SMART_CONTRACT_OPTION==1){
    contractData = david19Bytecode
  }
}

chooseSmartByteCode()

const deploy = async () => {
  console.log("#######################Deploying smart contract#######################")
  return await deploySmartContract(contractData,addressFrom,privKey)
}

module.exports = {
  deploy
}